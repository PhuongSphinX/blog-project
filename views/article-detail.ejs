<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>Article Detail</title>
</head>
<body>
<div class="header">
    <%include partials/navbar.ejs%>
</div>
<br>
<div class="card" style="width: 80%; margin-right: auto; margin-left: auto">
    <div class="card-body">
        <% article.forEach(function (article) { %>
        <% if(role ==='moderator') {   %>
        <a href="/articles/list" style="float: right">Back</a>
        <%  } else {  %>
        <a href="/articles" style="float: right">Back</a>
        <% }   %>
        <h2><%= article.title %></h2>
        <% if(authorId === user_id || role === 'moderator') {%>
        <a href="/articles/delete/<%= article.article_id %>" style="margin-right: 10%; float: right">
            <button type="button" class="btn btn-danger">Delete</button>
        </a>
        <a href="/articles/edit/<%= article.article_id %>" style="margin-right: 2%; float: right">
            <button type="button" class="btn btn-outline-primary">Edit</button>
        </a>
        <% } %>
        <small>Author: <%= article.username %></small>
        <br>
        <small>Created Date: <%= article.create_at.toDateString() %></small>
        <br><br>
        <div><%- article.content %></div>
        <% }); %>
    </div>

    <div style="width:95%; margin-right: auto; margin-left: auto">
        <form action="/articles/comments" method="post">
        <div class="input-group">
            <span class="input-group-addon" id="basic-addon1"><%= username %></span>
            <input type="text" class="form-control" placeholder="Your comment" aria-describedby="basic-addon1"
                   name="comment">
        </div>
        </form>
        <br>
        <ul class="list-group">
            <% comments.forEach(function (comment) { %>
            <li class="list-group-item">
                <p>
                    <strong><%= comment.username %></strong>
                    <strong><%= comment.fullname %></strong>
                    <small><%= comment.created_at.toDateString() %></small>
                    <% if(comment.user_id === user_id) {%>
                    <a href="/articles/comments/delete/<%= comment.comment_id%>" style="float: right">Delete</a>
                    <% }%>
                </p>
                <p><%= comment.content %></p>
            </li>
            <% }); %>
        </ul>
        <br>
    </div>
</div>
</body>
</html>